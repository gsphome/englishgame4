var H=Object.defineProperty;var d=(a,x)=>H(a,"name",{value:x,configurable:!0});import{r as g,u as A,a as J,d as X,b as Y,j as r}from"./index-M6D_uxQG.js";import{u as Z}from"./useToast-DWvUtLLM.js";import{u as _}from"./useLearningCleanup-CHNtf5mF.js";import{R as ee}from"./rotate-ccw-C5YwKoAy.js";import{C as re}from"./check-BwgYgpQD.js";const ie=d(({module:a})=>{const[x,v]=g.useState(null),[j,b]=g.useState({}),[h,u]=g.useState([]),[c,C]=g.useState(!1),[D]=g.useState(Date.now()),{updateSessionScore:M,setCurrentView:p}=A(),{updateUserScore:$}=J(),{addProgressEntry:I}=X(),{showCorrectAnswer:R,showIncorrectAnswer:W,showModuleCompleted:F}=Z();_();const[i,P]=g.useState({id:"",words:[],categories:[]});g.useEffect(()=>{const e=d(s=>{s.key==="Escape"&&p("menu")},"handleKeyPress");return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[p]),g.useEffect(()=>{var s;let e={id:"",words:[],categories:[]};if(a!=null&&a.data&&Array.isArray(a.data)){const t=a.data[0];if(t&&"category"in t&&"word"in t){const n=[...new Set(a.data.map(l=>l.category))].sort(()=>Math.random()-.5),{gameSettings:m}=Y.getState(),w=m.sortingMode.wordCount,f=m.sortingMode.categoryCount||3,V=n.slice(0,f),z=Math.ceil(w/f),N=[],B=V.map(l=>{const y=(a.data||[]).filter(k=>k.category===l).map(k=>k.word).slice(0,z);return N.push(...y),{name:l.charAt(0).toUpperCase()+l.slice(1),items:y}}),E=N.slice(0,w),G=B.map(l=>({...l,items:l.items.filter(y=>E.includes(y))}));e={id:"sorting-exercise",words:E,categories:G}}}if(P(e),((s=e.words)==null?void 0:s.length)>0){const t=[...e.words].sort(()=>Math.random()-.5);u(t);const o={};(e.categories||[]).forEach(n=>{o[n.name]=[]}),b(o)}},[a.id,a.data]);const T=d((e,s)=>{v(s),e.dataTransfer.effectAllowed="move"},"handleDragStart"),L=d(e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},"handleDragOver"),U=d((e,s)=>{e.preventDefault(),x&&(u(t=>t.filter(o=>o!==x)),b(t=>({...t,[s]:[...t[s]||[],x]})),v(null))},"handleDrop"),q=d((e,s)=>{c||(b(t=>({...t,[s]:(t[s]||[]).filter(o=>o!==e)})),u(t=>[...t,e]))},"handleRemoveFromCategory"),O=d(()=>{var t;let e=0;(i.categories||[]).forEach(o=>{const n=j[o.name]||[],m=o.items;n.length===m.length&&n.every(f=>m.includes(f))&&e++});const s=e===(((t=i.categories)==null?void 0:t.length)||0);M(s?{correct:1}:{incorrect:1}),s?R():W(),C(!0)},"checkAnswers"),K=d(()=>{const e=[...i.words].sort(()=>Math.random()-.5);u(e);const s={};(i.categories||[]).forEach(t=>{s[t.name]=[]}),b(s),C(!1)},"resetExercise"),Q=d(()=>{const e=Math.floor((Date.now()-D)/1e3),{sessionScore:s}=A.getState(),t=s.correct>0?100:0,o=s.accuracy;I({score:t,totalQuestions:s.total,correctAnswers:s.correct,moduleId:a.id,learningMode:"sorting",timeSpent:e}),F(a.name,t,o),$(a.id,t,e),p("menu")},"finishExercise"),S=h.length===0;return r.jsxs("div",{className:"max-w-6xl mx-auto p-3 sm:p-6",children:[r.jsxs("div",{className:"mb-4",children:[r.jsxs("div",{className:"flex justify-between items-center mb-3",children:[r.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-white",children:a.name}),r.jsxs("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 px-3 py-1 rounded-full",children:[i.words.length-h.length,"/",i.words.length]})]}),r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:r.jsx("div",{className:"bg-orange-600 h-1.5 rounded-full transition-all duration-300",style:{width:`${i.words.length>0?(i.words.length-h.length)/i.words.length*100:0}%`}})}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2 text-center",children:S?"All words sorted! Check your answers":"Drag and drop words into categories"})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Available Words"}),r.jsxs("div",{className:"min-h-[80px] p-4 bg-gray-50 dark:bg-gray-800 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg",children:[r.jsx("div",{className:"flex flex-wrap gap-2",children:h.map((e,s)=>r.jsx("div",{draggable:!0,onDragStart:d(t=>T(t,e),"onDragStart"),className:"px-2 py-1 sm:px-3 sm:py-2 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-lg cursor-move hover:bg-blue-200 dark:hover:bg-blue-800 transition-colors select-none text-xs sm:text-sm",children:e},`available-${s}-${e}`))}),h.length===0&&r.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center",children:"All words have been sorted!"})]})]}),r.jsx("div",{className:"grid grid-cols-3 gap-1 sm:gap-4 lg:gap-6 mb-4",children:(i.categories||[]).map(e=>{const s=j[e.name]||[],t=c&&s.length===e.items.length&&s.every(n=>e.items.includes(n)),o=c&&!t;return r.jsxs("div",{onDragOver:L,onDrop:d(n=>U(n,e.name),"onDrop"),className:`p-1 sm:p-4 border-2 border-dashed rounded-lg min-h-[140px] sm:min-h-[200px] ${c?t?"border-green-400 dark:border-green-500 bg-green-50 dark:bg-green-900":o?"border-red-400 dark:border-red-500 bg-red-50 dark:bg-red-900":"border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800":"border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800 hover:border-blue-400 dark:hover:border-blue-500"}`,children:[r.jsxs("h4",{className:"font-semibold text-gray-900 dark:text-white mb-2 sm:mb-3 text-center text-sm sm:text-base",children:[e.name,c&&r.jsx("span",{className:`ml-2 ${t?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:t?"✓":"✗"})]}),r.jsx("div",{className:"space-y-2",children:s.map((n,m)=>r.jsx("div",{onClick:d(()=>q(n,e.name),"onClick"),className:`px-1 py-1 sm:px-3 sm:py-2 rounded text-center cursor-pointer transition-colors text-xs sm:text-sm ${c?e.items.includes(n)?"bg-green-200 dark:bg-green-800 text-green-800 dark:text-green-200":"bg-red-200 dark:bg-red-800 text-red-800 dark:text-red-200":"bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-900 dark:text-white"}`,children:n},`${e.name}-${m}-${n}`))}),c&&o&&r.jsxs("div",{className:"mt-3 p-2 bg-yellow-50 dark:bg-yellow-900 border border-yellow-200 dark:border-yellow-700 rounded text-xs",children:[r.jsx("strong",{className:"text-yellow-800 dark:text-yellow-200",children:"Correct items:"})," ",r.jsx("span",{className:"text-yellow-700 dark:text-yellow-300",children:e.items.join(", ")})]})]},e.name)})}),r.jsxs("div",{className:"flex justify-center items-center gap-3 flex-wrap mt-6",children:[c?r.jsx("button",{onClick:Q,className:"flex items-center gap-2 px-6 py-2.5 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors text-sm font-medium shadow-sm",children:r.jsx("span",{children:"Finish Exercise"})}):r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:K,className:"p-2.5 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors shadow-sm",title:"Reset Exercise",children:r.jsx(ee,{className:"h-4 w-4"})}),r.jsxs("button",{onClick:O,disabled:!S,className:"flex items-center gap-2 px-6 py-2.5 bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 text-white rounded-lg transition-colors text-sm font-medium shadow-sm",children:[r.jsx(re,{className:"h-4 w-4"}),r.jsx("span",{children:"Check Answers"})]})]}),r.jsx("button",{onClick:d(()=>p("menu"),"onClick"),className:"flex items-center gap-1 px-4 py-2.5 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors text-sm font-medium",children:"← Menu"})]})]})},"SortingComponent");export{ie as default};
